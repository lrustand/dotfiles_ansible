- name: Install tmux.conf
  copy:
    src: etc/tmux.conf
    dest: /etc/
  become: yes

- name: Preserve TMUX variable for sudo
  copy:
    src: etc/sudoers.d/tmux
    dest: /etc/sudoers.d/tmux
  become: yes

- name: Check if TPM is installed
  stat:
    path: /home/{{ username }}/.tmux/plugins/tpm/bin/install_plugins
  register: tpm
  become: yes
  become_user: "{{ username }}"

- name: Install Tmux plugins
  command: /home/{{ username }}/.tmux/plugins/tpm/bin/install_plugins
  become: yes
  become_user: "{{ username }}"
  when: tpm.stat.exists
